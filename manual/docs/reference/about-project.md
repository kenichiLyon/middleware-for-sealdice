---
outline: deep
---

# 关于本项目的更多信息

## 本项目的诞生契机

本人作为 Sealdice-core 的深度使用者，由于各种原因，有很多像我这样有些技术的用户，被迫将协议端程序从 Windows 环境迁移至 Linux 环境，或反之；而在分离部署这个 case 下，因为海豹核心只传输 URI，在分开两个网络环境部署时，海豹核心与协议端无法正常发送图片、语音等外置资源，这也确实给我与用户带来了不便

@[PaineNate](https://github.com/PaineNate) 派恩纳特老师与 @[Szzrain](https://github.com/Szzrain) Szzrain 老师在海豹核心烹饪群的讨论启发了我，我自己动手制作了这个项目试图解决这个问题。在这里再次感谢派恩纳特老师与 Szzrain 老师。

本人技术力有限，只实现了 `a + b` 方案，`c` 方案由社区贡献，本仓库设置为 monorepo 模式也有考量到社区会有更多有能技术佬实现更多的模式，希望本项目能为海豹社区提供一个可能的设想。

## `a + b` 方案的原理

这里借鉴了 FTP 的模式，设置两个程序，一个是 `middleware-a`，一个是 `middleware-b`，为方便称呼下面简称 `a` 与 `b`。

`a`负责与协议端和 sealdice-core 两个程序进行通信，拦截并覆写 sealdice-core 的 message 事件和 cqcode 中关于 URI 的部分，同时，将 URI 的文件转发到到 `b`，将 `b` 返回的文件路径替换为协议端可以访问的 URI，从而实现问题的解决。

`b` 则负责接收 `a` 转发的文件，将其存储至本地，然后返回文件的本地的绝对路径。这也是为什么 `b` 必须要与协议端程序在同一台机器上才能正常工作。

实质上，`a` 与 `b`两程序将文件从 sealdice-core 程序所在的机器转发到了协议端程序所在的机器，从而实现了问题的解决。

## `c` 方案的原理

`c` 方案与 `a + b` 方案不同，`c` 方案只需要启动一个程序 `middleware-c`，就可以实现问题的解决。

`c` 负责与协议端和 sealdice-core 两个程序进行通信，把所有外置的多媒体文件资源转为 base64 编码，之后与`a`类似，覆写 sealdice-core 的 message 事件和 cqcode 中关于 URI 的部分，将原先的 URI 替换为 base64 路径，从而实现问题的解决。
